{
  "comments": [
    {
      "key": {
        "uuid": "9af37de9_f66c240a",
        "filename": "lib/NGCP/Panel/Controller/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 2837,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "in other places we did that with error callback, which would then contain a die() here. no need to duplicate calling NGCP::Panel::Utils::Message::error in here then.",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_0a5d3ce9",
        "filename": "lib/NGCP/Panel/Controller/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 2837,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-20T20:26:17Z",
      "side": 1,
      "message": "Hello Rene, \n\nI think that detailed error information, returned from the library method will allow us to unify error processing later without additional layer of the code in callbacks.\n\nYou see, ideally, all controllers, both API and WEB shouldn\u0027t contain business logic, it should be separated . Now role of the business logic keeper play Utils packages. In the same time, level of the business logic shouldn\u0027t be responsible for errors handling. Of course, callbacks allow to keep errors handling on Controllers level, but in the same time set of callbacks will piece of work to maake some global changes, if we will need some.\n\nReally, I believe that correct approach would be to have one universal method to raise error for both WEB UI and API, so it could be called from Utils packages too. But as far as we don\u0027t have this method now, I see detailed info return as the most universal, maintainable and lightweight solution.",
      "parentUuid": "9af37de9_f66c240a",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_4aa6a4c2",
        "filename": "lib/NGCP/Panel/Controller/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 2837,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-21T07:56:25Z",
      "side": 1,
      "message": "i understand the intention, but this approach just lacks flexibility.\n\n- what about more than one error, ie. when i want to use it in a from\u0027s validate?\n- the information in your error object is tied our way of bailing out in catalyst. (ie. respoonse code)\n- you need to iterate error objects if you ie. need to mark field\u0027s in a form\u0027s validate, see eg. Form/BillingNetworks/Reseller.pm\n- the caller has no control wether it wants to continue after the first errror (to ie. find more)\n- the error object doesnt contain info about the originating field\n- you cant\u0027t configure what errors you want to skip in certain situations\n- you have no possibility to provide your own error message string pattern\netc.",
      "parentUuid": "9af37de9_0a5d3ce9",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_aa9f505e",
        "filename": "lib/NGCP/Panel/Controller/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 2837,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-21T08:03:11Z",
      "side": 1,
      "message": "the original point here is that, at least form me, start placing NGCP::Panel::Utils::Message::error\u0027s inside the txn_do is a clear no-go.",
      "parentUuid": "9af37de9_4aa6a4c2",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_f63ae4e6",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 507,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "the return value differs from those of other brahches -\u003e thats why error callback is nicer imho.",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_cd106e51",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 507,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-23T12:55:14Z",
      "side": 1,
      "message": "They differ intentionally. \nYou see, during unified profile,profile_set input processing we can meet different errors, and this is why return detailed error information and handover controller to caller is OK. \nCallbacks, that we discuss in Controller/Subscriber, as they can keep only the same behavior for all wrong cases would be less flexible way to react on different error. With returned error information caller is still free to perform any actions on error.",
      "parentUuid": "9af37de9_f63ae4e6",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_d63fe0d4",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 513,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "isnt it auto-vivified by the first if?",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_4a0a24d4",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 513,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-21T10:30:54Z",
      "side": 1,
      "message": "No, this is special case for the web ui. I needed some time too to understand why we did have this comparison.\n\nThis is special case of subscriberadmin forms, that doesn\u0027t have profile_set_id field at all, so we need to get available for the subscriberadmin profile_set to check against it profile_id from request.",
      "parentUuid": "9af37de9_d63fe0d4",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_4d523e15",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 513,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-21T11:00:16Z",
      "side": 1,
      "message": "the first if branch is:\n\nif ($resource-\u003e{profile_set}{id}) {\n\nafter that, both \n\n- exists $resource-\u003e{profile_set}\n- exists $resource-\u003e{profile_set}-\u003e{id}\n\nwill be true.\n\nthis means it can never go into\n\n} elsif (!exists $resource-\u003e{profile_set}{id}) {",
      "parentUuid": "9af37de9_4a0a24d4",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_6012a9b6",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 513,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-23T12:55:14Z",
      "side": 1,
      "message": "I was under the same impression through the years, but seems like it is not correct now:\n\nroot@sp1:~# perl -e \u0027use Data::Dumper; my $a\u003d{\"b\"\u003d\u003e{ \"c\" \u003d\u003e \"d\" }}; if($a-\u003e{c}{k}){}elsif(!exists $a-\u003e{c}{k} ) {print \"! exists;\\n\";} \u0027\n\ngives me output :\n\n\n! exists;",
      "parentUuid": "9af37de9_4d523e15",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_f611c45e",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 548,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "if i understand correctly, you adjust the profile id instead of throwing a \"profile not allowed\" error. effectively means put2get\u0027s tests could fail?",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_ea0c3844",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 548,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-21T10:30:54Z",
      "side": 1,
      "message": "this is special processing of web administrator form.\nDue to non-dynamic profile field, that keeps values from pilot, e.g. in NGCP::Panel::Form::Customer::PbxExtensionSubscriber\n\nmy $set_id \u003d $c-\u003estash-\u003e{subscriber}-\u003eprovisioning_voip_subscriber-\u003eprofile_set_id;\n...\n\n$profile-\u003efield(\u0027id\u0027)-\u003eajax_src( $c-\u003euri_for_action(\u0027/subscriberprofile/profile_ajax\u0027, [$set_id])-\u003eas_string\n\n\nSo, if we didn\u0027t find profile for provided_id it also can mean (for administrative accounts only) that user just edited pilot subscriber and changed profile_set id and thus  couldn\u0027t select proper profile from profile_set",
      "parentUuid": "9af37de9_f611c45e",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_6d4d0272",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 548,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-21T11:00:16Z",
      "side": 1,
      "message": "but then wouldnt it be better to put this defaulting to the form validation method? seems to be not relevenat for api",
      "parentUuid": "9af37de9_ea0c3844",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_96095834",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 552,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "cannot determine allowed profile set",
      "range": {
        "startLine": 552,
        "startChar": 30,
        "endLine": 552,
        "endChar": 65
      },
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_4017a5a3",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 552,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-23T12:55:14Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9af37de9_96095834",
      "range": {
        "startLine": 552,
        "startChar": 30,
        "endLine": 552,
        "endChar": 65
      },
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_0a0e5c34",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 557,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "imho the error case would look more transparent if you make a straight 4branch-if?\n\nif (§profile_set and $profile) {\n#ok\n} elsif ($profile_set and not $profile) {\n\n} elsif (not $profile_set and $profile) {\n\n} else {\n\n}",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_8d3146ef",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 557,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-23T12:55:14Z",
      "side": 1,
      "message": "you see, here we have really nested branches, so flattered it would look as:\n\nif ($profile_set \u0026\u0026 !$profile \u0026\u0026 $resource-\u003e{profile}{id}){\n} elsif ($profile_set \u0026\u0026 !$profile \u0026\u0026 !$resource-\u003e{profile}{id}) {\n}\n\nthat is look a little bit unclear, as for me",
      "parentUuid": "9af37de9_0a0e5c34",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_ea3af8cc",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 579,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "but seems you remove obsolete pref values also if the profile is not changed?",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_2a9fe004",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 579,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-21T10:30:54Z",
      "side": 1,
      "message": "You see, \n1.we select all attributes connected to old profile into %old_profile_attributes\n2.We remove all attributes that are still actual in new profile\n3.Additionally we prepare separately id\u0027s of cf related attributes that aren\u0027t actual in new profile _for deletion_ \n4.We delete all preferences values not related to new profile\n5.Additionally we delete data from cf_mappings, related to deleted attributes",
      "parentUuid": "9af37de9_ea3af8cc",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_ed13325b",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 579,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-21T11:00:16Z",
      "side": 1,
      "message": "ok, so if profiles stay the same, %old_profile_atributes is empty, ok. may still skip this whole logic for performance reasons, if profile_id\u0027s are the same?",
      "parentUuid": "9af37de9_2a9fe004",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_6a2608bc",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 582,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "can this have dupes?",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_ea89d8cb",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 582,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-21T10:30:54Z",
      "side": 1,
      "message": "no, according to:\nshow create table voip_subscriber_profile_attributes;\n\n\u003d\u003e\nUNIQUE KEY `prof_attr_idx` (`profile_id`,`attribute_id`),",
      "parentUuid": "9af37de9_6a2608bc",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_ad1d2a68",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 582,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-21T11:00:16Z",
      "side": 1,
      "message": "ack ok, you need it for you intersect impl below.",
      "parentUuid": "9af37de9_ea89d8cb",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_2a20009b",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 589,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "where is this used?",
      "range": {
        "startLine": 589,
        "startChar": 15,
        "endLine": 589,
        "endChar": 19
      },
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_aa03d0b7",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 589,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-21T10:30:54Z",
      "side": 1,
      "message": "In line 597 as source for the map",
      "parentUuid": "9af37de9_2a20009b",
      "range": {
        "startLine": 589,
        "startChar": 15,
        "endLine": 589,
        "endChar": 19
      },
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_8d1a666d",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 589,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-21T11:00:16Z",
      "side": 1,
      "message": "ah, overlooked it.",
      "parentUuid": "9af37de9_aa03d0b7",
      "range": {
        "startLine": 589,
        "startChar": 15,
        "endLine": 589,
        "endChar": 19
      },
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_aa34f0dd",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 592,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-20T15:48:42Z",
      "side": 1,
      "message": "i presume you want to permently remove cfu, cfb, .. from %old_attibutes, not make sure they are not deleted.",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_6abcc86c",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 592,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2018-09-21T10:30:54Z",
      "side": 1,
      "message": "cfu is used to remove from voip_cf_mappings data related to removed attributes",
      "parentUuid": "9af37de9_aa34f0dd",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9af37de9_ad340ade",
        "filename": "lib/NGCP/Panel/Utils/Subscriber.pm",
        "patchSetId": 5
      },
      "lineNbr": 598,
      "author": {
        "id": 1000013
      },
      "writtenOn": "2018-09-21T11:00:16Z",
      "side": 1,
      "message": "$cfs gives you cfu/cfb/cft/etc. attributes that are not used in the new profile any longer. here the real call forwards get removed. ok makes sense (but is that really desired?)\n\nyou would then also need to check for other stuff to drop , ie. aig\u0027s fax settings etc..",
      "revId": "1859becc9d5cac66f079f9c7510cb44dbe195adc",
      "serverId": "85315e57-5f03-49c3-83f8-201ae2313a75",
      "unresolved": false
    }
  ]
}